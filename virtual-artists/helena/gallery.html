<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gallery - AetherWave Studio</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root { --bg1:#0a0a0a; --bg2:#1a1a2e; --bg3:#16213e; --cyan:#00d4ff; --violet:#7b2ff7; --magenta:#f72585; --text:#ffff; --muted:#a0a0a0; --card:#ffff0d; --line:#ffff1a; }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',sans-serif;color:var(--text);background:radial-gradient(1200px 800px at 80% -10%,#7b2ff722 0%,transparent 60%),radial-gradient(1000px 600px at -10% 20%,#00d4ff22 0%,transparent 60%),linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));min-height:100vh;overflow-x:hidden}
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:16px 0 8px;border-bottom:1px solid var(--line);margin-bottom:28px}
    .brand{display:flex;flex-direction:column}
    .logo{font-family:'Orbitron',sans-serif;font-weight:900;letter-spacing:2px;font-size:1.2rem;background:linear-gradient(135deg,var(--cyan),var(--violet),var(--magenta));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    .tagline{font-size:.75rem;color:var(--muted);letter-spacing:2px}
    .back-link{font-size:.85rem;opacity:.9;padding:10px 14px;border-radius:10px;border:1px solid var(--line)}
    .back-link:hover{border-color:#00d4ff80}
    .page-title{font-family:'Orbitron',sans-serif;font-size:2rem;text-align:center;margin-bottom:40px;color:var(--cyan)}
    .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}
    .gallery-item{background:var(--card);border-radius:15px;overflow:hidden;border:1px solid var(--line);cursor:pointer;transition:transform .3s ease,box-shadow .3s ease}
    .gallery-item:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(0,212,255,.2)}
    .gallery-image{width:100%;height:200px;object-fit:cover;display:block}
    .gallery-caption{padding:15px;font-size:.95rem;color:#d0d0d0;line-height:1.5}
    .gallery-caption strong{color:var(--cyan);font-weight:600}
    .empty-state{text-align:center;padding:60px 20px;color:var(--muted)}
    .empty-state h2{font-family:'Orbitron',sans-serif;color:var(--cyan);margin-bottom:15px}
    .empty-state a{color:var(--cyan);text-decoration:underline}
    .lightbox{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.9);align-items:center;justify-content:center}
    .lightbox-content{margin:auto;display:block;max-width:90%;max-height:90%;border-radius:10px;box-shadow:0 0 20px rgba(0,212,255,.5)}
    .close-button{position:absolute;top:20px;right:35px;color:#fff;font-size:40px;font-weight:bold;transition:.3s;cursor:pointer}
    .close-button:hover,.close-button:focus{color:var(--cyan);text-decoration:none;cursor:pointer}
    footer{margin:40px 0 12px;color:var(--muted);font-size:.85rem;text-align:center}
    @media (max-width:768px){.page-title{font-size:1.5rem}.gallery-grid{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">AETHERWAVE STUDIO</div>
        <div class="tagline">AI MUSIC • HUMAN SOUL • IMMERSIVE SOUND</div>
      </div>
      <a class="back-link" href="index.html"><span aria-hidden="true">←</span> Back to Artist</a>
    </header>

    <h1 class="page-title">Gallery</h1>
    <div class="gallery-grid" id="galleryGrid"></div>
  </div>

  <!-- Lightbox -->
  <div id="myLightbox" class="lightbox">
    <span class="close-button">×</span>
    <img class="lightbox-content" id="lightboxImg">
  </div>

  <footer>© <span id="year"></span> AetherWave Studio</footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    function escapeHtml(str){ return String(str ?? '').replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s])); }
    function getSlugFromQuery(){ return new URLSearchParams(location.search).get('slug')?.trim().toLowerCase() || ''; }
    function getDirSlug(){ const parts = location.pathname.split('/').filter(Boolean); return parts.length>=2 ? parts[parts.length-2].toLowerCase() : ''; }
    function currentSlug(){ const q=getSlugFromQuery(); if(q && !q.endsWith('.html')) return q; return getDirSlug(); }

    function getArtists(){ try{ return JSON.parse(localStorage.getItem('aetherwave_artists')||'[]'); } catch { return []; } }
    function getArtistName(slug){ const a=getArtists().find(x => (x.slug||'').toLowerCase()===slug); return a?.name || null; }

    function setTitle(slug){
      const name=getArtistName(slug);
      document.title = name ? `Gallery – ${name}` : `Gallery – ${slug || 'Artist'}`;
      const h1=document.querySelector('.page-title');
      if(h1) h1.textContent = name ? `${name} – Gallery` : `Gallery`;
    }

    function getGallery(){ try{ return JSON.parse(localStorage.getItem('aetherwave_gallery')||'[]'); } catch { return []; } }

    function renderGalleryForArtist(slug){
      setTitle(slug);
      const all=getGallery();
      const items=all.filter(it => (it.artistSlug || '').toLowerCase() === slug);
      const grid=document.getElementById('galleryGrid');
      if(!grid) return;

      if(!items.length){
        grid.innerHTML = `<div class="empty-state" style="grid-column:1 / -1;"><h2>No Gallery Items Yet</h2><p>Add gallery items for this artist in the <a href="/admin/">admin panel</a>.</p></div>`;
        return;
      }

      grid.innerHTML='';
      items.forEach(item=>{
        const title=escapeHtml(item.title || 'Untitled');
        const description=escapeHtml(item.description || '');
        const thumb=(item.thumb||'').trim() || 'https://placehold.co/400x300/667eea/ffff/png?text=No+Thumb';
        const full=(item.full||'').trim() || thumb;
        const div=document.createElement('div');
        div.className='gallery-item';
        div.setAttribute('data-src', full);
        div.innerHTML = `
          <img src="${thumb}" alt="${title}" class="gallery-image" onerror="this.src='https://placehold.co/400x300/667eea/ffff/png?text=Image+Not+Found'">
          <div class="gallery-caption"><strong>${title}:</strong> ${description}</div>`;
        grid.appendChild(div);
      });
      setupLightbox();
    }

    function setupLightbox(){
      const lightbox=document.getElementById('myLightbox');
      const lightboxImg=document.getElementById('lightboxImg');
      const closeButton=document.querySelector('.close-button');
      const galleryItems=document.querySelectorAll('.gallery-item');
      galleryItems.forEach(item=>{
        item.addEventListener('click', function(){
          lightbox.style.display='flex';
          lightboxImg.src=this.getAttribute('data-src') || this.querySelector('img')?.src || '';
        });
      });
      closeButton.addEventListener('click', ()=> lightbox.style.display='none');
      lightbox.addEventListener('click', (e)=>{ if(e.target===lightbox) lightbox.style.display='none'; });
    }

    (function init(){
      const slug = currentSlug();
      renderGalleryForArtist(slug);
    })();

    window.addEventListener('storage', (e)=>{
      if(e.key==='aetherwave_gallery'){
        const slug=currentSlug();
        renderGalleryForArtist(slug);
      }
    });
  </script>
</body>
</html>