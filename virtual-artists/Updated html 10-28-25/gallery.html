<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gallery – AetherWave Studio</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root { --bg1:#0a0a0a; --bg2:#1a1a2e; --bg3:#16213e; --cyan:#00d4ff; --violet:#7b2ff7; --magenta:#f72585; --text:#ffffff; --muted:#a0a0a0; --card:#1a1a2e; --line:#333355; }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',sans-serif;color:var(--text);background:linear-gradient(135deg,var(--bg1),var(--bg2) 50%,var(--bg3));min-height:100vh}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:16px 0 8px;border-bottom:1px solid var(--line);margin-bottom:28px}
    .brand{display:flex;flex-direction:column}
    .logo{font-family:'Orbitron',sans-serif;font-weight:900;letter-spacing:2px;font-size:1.2rem;background:linear-gradient(135deg,var(--cyan),var(--violet),var(--magenta));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    .tagline{font-size:.75rem;color:var(--muted);letter-spacing:2px}
    .back-link{font-size:.85rem;opacity:.9;padding:10px 14px;border-radius:10px;border:1px solid var(--line)}
    .back-link:hover{border-color:#00d4ff80}
    h1{font-family:'Orbitron',sans-serif;color:var(--cyan);margin:18px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .thumb{width:100%;height:180px;object-fit:cover;background:#0a0a0a}
    .content{padding:12px}
    .title{font-weight:600;margin-bottom:6px}
    .desc{font-size:.9rem;color:var(--muted)}
    .empty{color:var(--muted);text-align:center;padding:40px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">AETHERWAVE STUDIO</div>
        <div class="tagline">AI MUSIC • HUMAN SOUL • IMMERSIVE SOUND</div>
      </div>
      <a class="back-link" href="./"><span aria-hidden="true">←</span> Back</a>
    </header>

    <h1 id="pageTitle">Gallery</h1>
    <div id="galleryGrid" class="grid"></div>
    <div id="emptyState" class="empty" style="display:none;">No gallery items found.</div>
  </div>

  <script>
    function escapeHtml(str){ return String(str ?? '').replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s])); }
    function getDirSlug(){ const parts = location.pathname.split('/').filter(Boolean); return parts.length>=2 ? parts[parts.length-2].toLowerCase() : ''; }

    async function loadData() {
      try {
        const res = await fetch('/virtual-artists/data/content.json', { cache: 'no-cache' });
        if (!res.ok) throw new Error('no content.json');
        return await res.json();
      } catch {
        return {
          artists: JSON.parse(localStorage.getItem('aetherwave_artists') || '[]'),
          gallery: JSON.parse(localStorage.getItem('aetherwave_gallery') || '[]'),
          merch: JSON.parse(localStorage.getItem('aetherwave_merch') || '[]')
        };
      }
    }

    function renderGallery(data, artistSlug) {
      const grid = document.getElementById('galleryGrid');
      const empty = document.getElementById('emptyState');
      const titleEl = document.getElementById('pageTitle');

      const artist = (data.artists||[]).find(a => (a.slug||'').toLowerCase()===artistSlug);
      if (artist) {
        document.title = `${artist.name} – Gallery`;
        titleEl.textContent = `${artist.name} – Gallery`;
      } else {
        document.title = `Gallery – AetherWave Studio`;
      }

      const items = (data.gallery||[]).filter(i => (i.artistSlug||'').toLowerCase()===artistSlug);
      grid.innerHTML = '';
      if (items.length === 0) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      items.forEach(item => {
        const title = escapeHtml(item.title || 'Untitled');
        const desc = escapeHtml(item.description || '');
        const thumb = (item.thumb||'').trim() || 'https://placehold.co/600x400/222/fff?text=Gallery';
        grid.innerHTML += `
          <div class="card">
            <img class="thumb" src="${thumb}" alt="${title}" onerror="this.src='https://placehold.co/600x400/222/fff?text=Gallery'">
            <div class="content">
              <div class="title">${title}</div>
              <div class="desc">${desc}</div>
            </div>
          </div>
        `;
      });
    }

    (async function init(){
      const artistSlug = getDirSlug();
      const data = await loadData();
      renderGallery(data, artistSlug);
    })();
  </script>
</body>
</html>